{% extends "page_layout.html" %}
{% load geonode_auth %}
{% load i18n %}
{% comment %}
{% load comments %}
{% endcomment %}
{% load mdtools %}

{% block title %} {{ layer.title }} - {{ block.super }} {% endblock %}

{% block head %}
{% include "geonode/ext_header.html" %}
{% include "geonode/app_header.html" %}
{% include "geonode/geo_header.html" %}

<script type="text/javascript" src="/static/cigno/theme/js/RelationsManager.js"></script>  

<!-- JIT Library File -->
<script type="text/javascript" src="/static/cigno/externals/jit/js/jit-yc.js"></script>

<!--link rel="stylesheet" type="text/css" href="{{ GEONODE_CLIENT_LOCATION }}theme/ux/colorpicker/color-picker.ux.css" /-->

<style>
  .newline {
    margin-left: 10px;
    display: block;
  }
  .newline_detail {
    margin-left: 10px;
    font-size: 90%;
    display: block;
    color: #999999;
  }

  #id_comment {
     width: 250px;
  }

  #id_bbox{
    text-align: center;
  }

/* hypertree */
#infovis{
    width: 100%;
    height: 70%;
    background-color: #1A1A1A;
    color: #cccccc;
    text-align: center;
}
#infovis div{
    font-family: "Lucida Grande",Verdana;
}

#inner-details p{
    margin: 5px;
}
</style>

{{ block.super }}

    <script type="text/javascript">
{% autoescape off %}
        Ext.onReady(function() {
{% has_obj_perm user layer "metadata.change_resource_permissions" as can_change_permissions %}
{% if can_change_permissions %}
            new GeoNode.PermissionsEditor({
                renderTo: "permissions_form",
                userLookup: "{% url geonode.views.ajax_lookup %}",
                permissions: {{ permissions_json }},
                levels: {
                    'admin': 'resource_admin',
                    'readwrite': 'resource_readwrite',
                    'readonly': 'resource_readonly',
                    '_none': '_none'
                },
                listeners: {
                    updated: function(perms) {
                        var submitTo = "{% url cigno.metadata.views.ajax_resource_permissions layer.id %}";
                        Ext.Ajax.request({ url: submitTo, jsonData: perms.writePermissions() });
                    }
                }
            });
{% endif %}

           var related_resources_panel = new Cigno.RelationsManager({
              renderTo:'related_resources-manager',
              rdf_url: '{% url cigno.mdtools.views_rdf.graph_connections %}',
              rdf_s: '{{ layer.get_absolute_url }}'
           });
        });

        function showStyle(styleName) {
            
            if (!styleName) {
                Ext.ComponentMgr.all.on("add", function(index, object) {
                    if (object instanceof gxp.WMSStylesDialog) {
                        Ext.ComponentMgr.all.un("add", arguments.callee);
                        object.on("ready", function() {
                            object.addStyle();
                        }, this, {single: true});
                    }
                });
            }
            app.tools["styler"].actions[0].execute();
        }
{% endautoescape %}
    </script>
    <script>
      contactInfo = new Ext.Window({
        title: "Info",
        autoHeight: true,
        width: 280,
        closeAction: "hide",
        bodyStyle: "background-color: white;",
        //items: stylesPanel,
        listeners: {
           "beforeclose": function() {
              styleEditor = null;
           }
        } 
      });

</script>
<style>
/* treepanel */
   #related_resources-manager ul {
      list-style-type: none;
   }

/*  .mdsection {
    margin-left: -15px;
    margin-right: -15px;
  }
*/
  .newline {
    margin-left: 10px;
    display: block;
  }
  .newline_detail {
    margin-left: 10px;
    font-size: 90%;
    display: block;
    color: #999999;
  }
</style>
{% endblock %}

{% block main %}
<div class="twocol">
<div id="description"> <h3> {{ layer.titleml }} </h3> </div>
<p>  </p>
<p> 
  {% if layer.thumbnail_exists %}
  <a href="{{link}}"><img src="{{ layer.thumbnail_exists }}" align="right"/></a>
  {% endif %}
  <strong>{% trans "Abstract" %}:</strong> {{ layer.abstractml|default:_("No abstract for this resource.") }}  
</p>

{% if layer.gemetkeywords %}
<p> <strong>{% trans "Keywords" %}:</strong> 
   <ul>
     {% for k in layer.keywords_list_language %}
      <li><a target="_blank" href="{{ k.1 }}">{{ k.3 }}</a>
        <span class="newline_detail">{{ k.0 }}</span>
        <span class="newline_detail">{{ k.2 }}</span>
      </li>
    {% endfor %}
   </ul>
</p>
{% endif %}

{% if layer.format %}<p> <strong>{% trans "Format" %}:</strong> {{ layer.format }} </p>{% endif %}

{% if layer.resource_type %}<p> <strong>{% trans "Resource type" %}:</strong> {{ layer.resource_type }} </p>{% endif %}

{% if layer.language %}<p> <strong>{% trans "Language" %}:</strong> {{ layer.language }} </p>{% endif %}

<hr/>
<p> <strong>{% trans "Metadata creation" %}:</strong> {{ layer.md_creation|date:"DATETIME_FORMAT" }} </p>
<p> <strong>{% trans "Metadata revision" %}:</strong> {{ layer.md_last_modify|date:"DATETIME_FORMAT" }} </p>
<p> <strong>{% trans "Contact" %}</strong> <a href="{% url profiles.views.profile_detail layer.owner.username %}">{{ layer.owner.username }}</a> </p>
</div>
{% endblock %}

{% block sidebar %}
<div id="sidebar" class="threecol">
    <h3> {% trans "Related resources" %}</h3>
    <div id="related_resources-manager"></div>
    <h3> {% trans "Download" %} </h3>
    <p> <strong>{% trans "Data" %}: </strong>
        {% for extension, type, link in layer.download_links %}
            <a href="{{link}}">{{type}}</a>
        {% endfor %}
    </p>
    <p> <strong>{% trans "Metadata" %}: </strong>
        {% for mimetype, mdtype, link in layer.metadata_links %}
            <a href="{{link}}">{{mdtype}}</a>
        {% empty %}
            <em> {% trans "No metadata links provided for this data." noop %} </em>
        {% endfor %}
    </p>

    {% if user.is_authenticated %}
    {% has_obj_perm user layer "metadata.change_resource" as can_change %}
    {% has_obj_perm user layer "metadata.delete_resource" as can_delete %}
    {% if can_change or can_delete or can_change_permissions %}

        <h3> {% trans "Manage" %} </h3>
        <ul>
			{% if user.is_authenticated %}
        {% if can_change %}
                <li><a href="?describe">{% trans "Update the description of this data" %} ({% trans "simple form" %})</a></li>
                <li><a href="/admin/metadata/resource/{{layer.pk}}/">{% trans "Update the description of this data" %} ({% trans "advanced form" %})</a></li>
                <!--li><a href="?update">{% trans "Upload a new version of this data" %}</a></li-->
        {% endif %}
        {% if can_change_permissions %}
        <li><a href="{% url edit_resource_permissions layer.pk %}">{% trans "Edit Permissions" %}</a></li>
        {% endif %}
            {% if can_delete %}
				<li><a href="?remove">{% trans "Remove" %}</a></li>
			{% endif %}
			{% else %}
				<li>Please authenticate to update or remove layers</li>
			{% endif %}
        </ul>
    {% endif %}
    {% has_obj_perm user layer "metadata.change_resource_permissions" as can_change_permissions %}
    {% if can_change_permissions %}
    <h3>{% trans "Permissions" %}</h3>
      <div id="permissions_form"></div>
    {% endif %}
    {% endif %}

    {% comment %}

    <p></p>	   
    <h3> {% trans "Comments" %} </h3>
    {% get_comment_count for metadataMetadata as comment_count %}
    <p>{{ comment_count }} comments have been posted.</p>
    {% render_comment_list for metadataMetadata %}

    <h4> {% trans "Add a comment" %} </h4>
    {% render_comment_form for metadataMetadata %}

    {% endcomment %}


</div>
{% endblock %}
